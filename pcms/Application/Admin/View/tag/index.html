<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<title></title>
	<link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/assets/skin/default_skin/css/theme_inner.css">
    <!-- Admin Forms CSS -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/assets/admin-tools/admin-forms/css/admin-forms.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/css/custom.css">
    <script type="text/javascript" src="__PUBLIC__/admin/vendor/jquery/jquery-1.11.1.min.js"></script>
    <script>
     // 弹出框提示
 	 if('${info}' != ""){
 		//parent.bootAlert('${info}');
 	 }

     // 删除确认框 
     function del(url,name){
        parent.bootConfirm(url,name);
     }
     
	 $(document).ready(function(){
	    // 全选
	 	$('#all').click(function() { 
         	$('.item').prop('checked', $(this).is(':checked')); 
     	}); 
    
		// 赋值grade
		$('#category').change(function(){
			var optionId = "option"+$(this).val();
			var optionName = $('#'+optionId).attr("name");
			$('#grade').val(optionName);
		});
		
     	// 获取与点击<a>元素有相同grade的上一层的 <a>元素的父级<tr>元素   -- @param $self 为<a>元素; @param $prev为$self的父级<tr>元素的上级<tr>元素
     	function samePrev($self,$prev){
     	    // 若不是常规的列表中的tr,则跳出
     		if($prev.find('.movedown').attr('grade') == null){ return null; }
     		
	        var selfGrade = $self.attr('grade');
	    	var prevGrade = $prev.find('.moveup').attr('grade')
	    	if(selfGrade == prevGrade){
	    		return $prev;
	    	}else{
	    		var $pp = $prev.prev();
	    		return samePrev($self,$pp);
	    	}
	    }
	    
	    
	    // 获取与点击<a>元素有相同grade的下一层的 <a>元素的父级<tr>元素   -- @param $self 为<a>元素; @param $next为$self的父级<tr>元素的下级<tr>元素
     	function sameNext($self,$next){
     		// 若不是常规的列表中的tr,则跳出
     		if($next.find('.movedown').attr('grade') == null){ return null; }
     		
	        var selfGrade = $self.attr('grade');
	    	var nextGrade = $next.find('.movedown').attr('grade')
	    	if(selfGrade == nextGrade){
	    		return $next;
	    	}else{
	    		var $nn = $next.next();
	    		return sameNext($self,$nn);
	    	}
	    }
     	
     	// 上移
     	$('.moveup').click(function(){    	    
     		var myGrade = $(this).attr('grade');
     		var rpGrade = $(this).parent().parent().prev().find('.moveup').attr('grade');    // 第一个parent()到<td> 第二个parent()到 <tr> prev() 到上一个<tr>
     		
     		if(myGrade > rpGrade){ 
     			parent.bootAlert('已经移动到本层级最顶端，无法再往上移动！'); 
     		}else{
     			var $self = $(this);
     			var $prev = samePrev($self,$self.parent().parent().prev());
     			
     		    var myId = $self.attr('id');
     	    	var rpId = $prev.find('.moveup').attr('id');
	
     	    	var myOrders = $self.attr('orders');
     	    	var rpOrders = $prev.find('.moveup').attr('orders');
     	    	
     	    	$.ajax({
			    	type: 'POST',
			    	url:  '/admin/setting/navigation/move' ,
			    	data: {'myId':myId,'rpId':rpId,'myOrders':myOrders,'rpOrders':rpOrders},
			    	success: function(data){ parent.bootAlert(data); }
				});	
     		}
     	});  
     	
     	// 下移
     	$('.movedown').click(function(){
     		var myGrade = $(this).attr('grade');
     		var rpGrade = $(this).parent().parent().next().find('.movedown').attr('grade');
     		if(myGrade > rpGrade){ 
     			parent.bootAlert('已经移动到本层级最末端，无法再往下移动！'); 
     		}else{
     		    var $self = $(this);
     			var $next = sameNext($self,$self.parent().parent().next());
     			
     		    var myId = $self.attr('id');
     	    	var rpId = $next.find('.movedown').attr('id');
     	    	
     	    	var myOrders = $self.attr('orders');
     	    	var rpOrders = $next.find('.movedown').attr('orders');
     	    	
     	    	$.ajax({
			    	type: 'POST',
			    	url:  '/admin/setting/navigation/move' ,
			    	data: {'myId':myId,'rpId':rpId,'myOrders':myOrders,'rpOrders':rpOrders},
			    	success: function(data){ parent.bootAlert(data); }
				});	
     		}
     	});
	    
	     
	    
	 });
     </script>
</head>
<body>
<div class="custom_main">
<div class="custom_title">
	<span class="custom_title_word">标签管理</span>
</div>
<div class="custom_body">
<table class="table table-hover" id="datatable3" cellspacing="0" width="100%">
    <thead>
        
<tr>

	<!-- 添加标签组名 -->
	<form id="inputForm" class="form-horizontal" action="{:U('admin/tag/add_group')}" method="post">
		<div class="form-group">
		
		<label class="control-label pull-left" style="padding-top:20px;padding-left:42px;width:130px">添加组名:</label>	
		<div class="col-md-2 col-sm-2" style="padding-top:15px">
			<input type="text" name="name" placeholder="标签组名称" class="form-control input-sm" />				
		</div>
		
		<div class="admin-form">
			<input type="submit" class="btn input-sm" style="padding-top:5px;margin-top:15px" value="添  加"/ ></tr>
		</div>
		</div>
	</form>
	
	<!-- 添加标签 -->
	<form id="inputForm" class="form-horizontal" action="{:U('admin/tag/add_tag')}" method="post">
		<div class="form-group">
		
		<label class="control-label pull-left" style="padding-top:20px;padding-left:42px;width:130px">添加标签:</label>
	
		<div class="col-md-2 col-sm-2  admin-form">
			<label class="field select">
				<select name="group_id" style="height:30px;padding:0px;font-size:12px;margin-top:15px">
					<option value="0">&nbsp;&nbsp;选择标签组</option>
					<volist name="groups" id="group">
						<option value="{$group.id}">
							{$group.name}	
						</option>
					</volist>
				</select>
		    </label>
		</div>
		
		<div class="col-md-2 col-sm-2" style="padding-top:15px;padding-left:0px;padding-bottom:30px">
			<input type="text" name="name" placeholder="标签名称" class="form-control input-sm" />				
		</div>
		
		<div class="admin-form">
			<input type="submit" class="btn input-sm" style="padding-top:5px;margin-top:15px" value="添  加"/ ></tr>
		</div>
		</div>
	</form>
	
	
</tr> 
         
         
            <tr>
              
                <th width="20%">标签组名</th>
                <th width="70%">标签内容</th>
                <th width="10%">管理操作</th>
            </tr>
            
        </thead>

        <tbody>
                                                                                                                               
   		<volist name="groups" id="group">
   		
			<tr>
			    
				<td>{$group.name}</td>

				<td>
					<cu:taglist group_id="1"></cu:taglist>
				</td>
				<td>
					<a href="#" onclick="del('{:U('/admin/navigation/del',array('id'=>$navigation[id]))}',this.name)" name="${navigation.name}">删除本组</a>
				</td>
			</tr>
		</volist>
       </tbody>
       
</table>
</div>
</div>


</body>
</html>

